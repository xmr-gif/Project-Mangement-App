<!-- Modal Backdrop -->
<div class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50" (click)="onClose()">

  <!-- Modal Content -->
  <div class="bg-gray-800 rounded-xl p-6 w-full max-w-md" (click)="$event.stopPropagation()">

    <!-- Header -->
    <div class="flex items-center justify-between mb-6">
      <h2 class="text-white text-xl font-bold">Create New Ticket</h2>
      <button (click)="onClose()" class="text-gray-400 hover:text-white">
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
        </svg>
      </button>
    </div>

    <!-- Form -->
    <div class="space-y-4">

      <!-- Title -->
      <div>
        <label class="block text-gray-300 text-sm font-medium mb-2">Title</label>
        <input
          type="text"
          [value]="title()"
          (input)="title.set($any($event.target).value)"
          placeholder="Enter ticket title..."
          class="w-full bg-gray-900 text-white px-4 py-2 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 border border-gray-700"
        />
      </div>

      <!-- Priority -->
      <div>
        <label class="block text-gray-300 text-sm font-medium mb-2">Priority</label>
        <div class="relative priority-dropdown">
          <button
            type="button"
            (click)="togglePriorityDropdown($event)"
            class="w-full flex items-center justify-between px-4 py-2 bg-gray-900 text-white rounded-lg text-sm border border-gray-700 hover:bg-gray-800">
            <span class="flex items-center gap-2">
              @if (priority() === 'High') {
                <span class="w-2 h-2 rounded-full bg-red-500"></span>
              } @else if (priority() === 'Medium') {
                <span class="w-2 h-2 rounded-full bg-yellow-500"></span>
              } @else if (priority() === 'Low') {
                <span class="w-2 h-2 rounded-full bg-green-500"></span>
              }
              {{ priority() }}
            </span>
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
            </svg>
          </button>

          @if (showPriorityDropdown()) {
            <div class="absolute top-full mt-2 left-0 right-0 bg-gray-900 border border-gray-700 rounded-lg shadow-xl z-50">
              @for (p of priorities; track p) {
                <button
                  type="button"
                  (click)="selectPriority(p, $event)"
                  class="w-full text-left px-4 py-2 hover:bg-gray-800 text-white text-sm first:rounded-t-lg last:rounded-b-lg flex items-center gap-2">
                  @if (p === 'High') {
                    <span class="w-2 h-2 rounded-full bg-red-500"></span>
                  } @else if (p === 'Medium') {
                    <span class="w-2 h-2 rounded-full bg-yellow-500"></span>
                  } @else if (p === 'Low') {
                    <span class="w-2 h-2 rounded-full bg-green-500"></span>
                  }
                  {{ p }}
                </button>
              }
            </div>
          }
        </div>
      </div>

      <!-- Start Date -->
      <div>
        <label class="block text-gray-300 text-sm font-medium mb-2">Start Date</label>
        <input
          type="date"
          [value]="startDate()"
          (input)="startDate.set($any($event.target).value)"
          class="w-full bg-gray-900 text-white px-4 py-2 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 border border-gray-700"
        />
      </div>

      <!-- End Date -->
      <div>
        <label class="block text-gray-300 text-sm font-medium mb-2">End Date</label>
        <input
          type="date"
          [value]="endDate()"
          (input)="endDate.set($any($event.target).value)"
          class="w-full bg-gray-900 text-white px-4 py-2 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 border border-gray-700"
        />
      </div>

      <!-- Assignees -->
      <div>
        <label class="block text-gray-300 text-sm font-medium mb-2">Assignees</label>
        <div class="relative assignee-dropdown">
          <button
            type="button"
            (click)="toggleAssigneeDropdown($event)"
            class="w-full flex items-center justify-between px-4 py-2 bg-gray-900 text-white rounded-lg text-sm border border-gray-700 hover:bg-gray-800">
            <span>{{ getSelectedAssigneesText() }}</span>
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
            </svg>
          </button>

          @if (showAssigneeDropdown()) {
            <div class="absolute top-full mt-2 left-0 right-0 bg-gray-900 border border-gray-700 rounded-lg shadow-xl z-50 max-h-48 overflow-y-auto">
              @for (assignee of assignees; track assignee.id) {
                <button
                  type="button"
                  (click)="toggleAssignee(assignee.id, $event)"
                  [class.bg-gray-800]="isAssigneeSelected(assignee.id)"
                  class="w-full flex items-center gap-3 px-4 py-2 hover:bg-gray-800 text-white text-sm transition-colors">
                  <div class="flex items-center justify-center w-4 h-4 border-2 border-gray-600 rounded"
                       [class.bg-blue-600]="isAssigneeSelected(assignee.id)"
                       [class.border-blue-600]="isAssigneeSelected(assignee.id)">
                    @if (isAssigneeSelected(assignee.id)) {
                      <svg class="w-3 h-3 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7" />
                      </svg>
                    }
                  </div>

                  @if (assignee.avatar) {
                    <img [src]="assignee.avatar" class="w-6 h-6 rounded-full" [alt]="assignee.name">
                  } @else {
                    <div class="w-6 h-6 rounded-full bg-blue-600 flex items-center justify-center text-xs text-white font-bold">
                      All
                    </div>
                  }
                  <span>{{ assignee.name }}</span>
                </button>
              }
            </div>
          }
        </div>
      </div>

    </div>

    <!-- Actions -->
    <div class="flex gap-3 mt-6">
      <button
        type="button"
        (click)="onClose()"
        class="flex-1 px-4 py-2 bg-gray-700 text-white rounded-lg hover:bg-gray-600 text-sm font-medium">
        Cancel
      </button>
      <button
        type="button"
        (click)="onSubmit()"
        class="flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 text-sm font-medium">
        Create Ticket
      </button>
    </div>

  </div>

</div>
